<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Análise do resultado da eleição presidencial de 2022">
    <meta name="author" content="Rafael Leite">

    <title>Eleições 2022</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/dashboard/">

    <!-- CSS -->
    <link href="./dashboard.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
        integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="./bootstrap-select.css" rel="stylesheet">


    <!-- JS Bibliotecas -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="./funcoes.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
        integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/7.8.0/simple-statistics.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>

    <!-- Gráficos -->
    <script src="./mapas/mapa_urnas_atrasadas.js"></script>
    <script src="./graficos/grafico_urnas_atrasadas_por_uf.js"></script>


    <!-- JS Dados -->
    <script src="./dados/votacao_por_zona_por_municipio.js"></script>
    <script src="./dados/estados_por_regiao.js"></script>
    <script src="./dados/votacao_urnas.js"></script>
    <script src="./dados/centroide_municipios.js"></script>
    <script src="./dados/estados_shape.js"></script>
    <script src="./dados/rm_shape.js"></script>
    <script src="./dados/eleicoes_2018.js"></script>
    <script src="./dados/urnas_unanimes.js"></script>
    <script src="./dados/municipios_divergentes.js"></script>
    <script src="./dados/urnas_atrasadas.js"></script>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SZLLC4RXF9"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-SZLLC4RXF9');
</script>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12 col-xs-12d-sm-block d-md-none bg-light">
                <div class="row my-2">
                    <div class="col-6">
                        <center>
                            <img src="./assets/profile_pic.jpg" width="80" height="80"
                                style="border-radius: 50%; border: 2px solid #000;">
                        </center>
                    </div>
                    <div class="col-6">
                        <center>
                            <div class="h6 mb-0">Rafael Leite</div>
                            <div class="h5 my-2">
                                <a class="mx-1" href="https://twitter.com/rafnleite" target="_blank"><i
                                        class="fab fa-twitter"></i></a>
                                <a class="mx-1" href="https://www.linkedin.com/in/rafnleite/" target="_blank"><i
                                        class="fab fa-linkedin-in"></i></a>
                        </center>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 d-none d-md-block bg-light sidebar">
                <nav id="navegador" class="sidebar-sticky">
                    <center>
                        <img src="./assets/profile_pic.jpg" width="120" height="120"
                            style="border-radius: 50%; border: 2px solid #000;">
                        <div class="h6 mb-0">Rafael Leite</div>
                        <div class="h5 my-2">
                            <a class="mx-1" href="https://twitter.com/rafnleite" target="_blank"><i
                                    class="fab fa-twitter"></i></a>
                            <a class="mx-1" href="https://www.linkedin.com/in/rafnleite/" target="_blank"><i
                                    class="fab fa-linkedin-in"></i></a>
                        </div>
                    </center>
                    <hr>
                    <ul id="listaNavegador" class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#introducao">
                                Introdução <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#auditorias">
                                Auditorias em urnas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#tipos">
                                Votação por tipo de urna
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#graficos">
                                Comportamento de gráficos
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#unanimes">
                                Urnas unâmines
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#codigofonte">
                                Código-fonte das urnas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#alteracoes">
                                Os dados foram alterados após a live?
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./relatorio_eleicoes.html/#conclusao">
                                Conclusão
                            </a>
                        </li>

                        <h6
                            class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                            <span>Extras</span>
                        </h6>
                        <ul class="nav flex-column mb-2">
                            <li class="nav-item">
                                <a class="nav-link" href="./votacao_por_secao.html">
                                    Votação por seção
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="./atraso_secoes.html">
                                    Urnas com atraso
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://capyvara.github.io/locais_votacao_resultados_2022.html"
                                    target="_blank">
                                    Mapa de votos (Por Marcelo Oliveira)
                                </a>
                            </li>
                        </ul>
                </nav>
            </div>

            <main role="main" class="col-lg-9 col-md-8 col-sm-12 col-xs-12 text-center">
                <div class="row">
                    <div class="col-12">
                        Filtrar apenas seções com encerramento após:
                        <div class="h5" id="horarioUrnasAtrasadas"></div>
                        <input type="range" min="10" max="360" value="3" step="1"
                            class="form-range slider slider-width100 horarioUrnasAtrasadas" id="sliderUrnasAtrasadas"
                            width="100%" oninput="atualizarUrnasAtrasadas()">
                        <table class="table table-bordered mb-0" style="table-layout: fixed ; width: 100%;">
                            <tr>
                                <td class="h6">Número de urnas</td>
                                <td class="h6">Eleitores</td>
                                <td class="h6">Lula</td>
                                <td class="h6">Bolsonaro</td>
                                <td class="h6">Diferença</td>
                            </tr>
                            <td>
                                <div id="numeroUrnasAtrasadas" class="h6"></div>
                            </td>
                            <td>
                                <div id="eleitoresUrnasAtrasadas" class="h6"></div>
                            </td>
                            <td>
                                <div id="lulaUrnasAtrasadas" class="h6"></div>
                            </td>
                            <td>
                                <div id="bolsonaroUrnasAtrasadas" class="h6"></div>
                            </td>
                            <td>
                                <div id="diferencaUrnasAtrasadas" class="h6"></div>
                            </td>
                            </tr>
                        </table>
                        <small class="mt-0">*Em 44 urnas, não consta o horário de encerramento no arquivo de resumo de
                            boletins de urna.</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-9 col-xl-9">
                        <div map class="mt-2" id="mapaUrnasAtrasadas"
                            style="height: 720px; width:100%; border-style: solid; border-color: rgb(0, 0, 0);">
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 col-xl-3 mx-0 px-0">
                        <div style="height: 600px">
                            <canvas class="my-3" id="graficoUrnasAtrasadasCanvas" height="600px"></canvas>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>




    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
        feather.replace()
    </script>

    <!-- Dados -->
    <script>
        // Cache selectors
        // JavaScript Document

        // Can also be used with $(document).ready() / $(window).load()
        $(document).ready(function () {
            urnasAtrasadasFiltradas = {
                crs: {
                    "type": "name",
                    "properties": {
                        "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
                    }
                },
                features: [],
                name: "locais_votacao",
                type: "FeatureCollection"
            }

            criarMapaUrnasAtrasadas()
            atualizarUrnasAtrasadas()
        });

        function atualizarUrnasAtrasadas() {
            atraso = $(`#sliderUrnasAtrasadas`).val()
            $(`#horarioUrnasAtrasadas`).html(moment('2022-10-30 17:00').add(atraso, 'minutes').format('HH:mm'))
            // console.log(urnasAtraso_)
            urnasAtrasadasFiltradas.features = urnasAtrasadas.features.filter(x => x.properties.atraso > moment('2022-10-30 00:00').add(atraso, 'minutes').format('HH:mm:ss'))
            stats = urnasAtrasadasFiltradas.features.map(x => x.properties)
            numeroUrnas = stats.length
            eleitores = stats.reduce((prev, cur) => cur.qt_aptos + prev, 0)
            lula = stats.reduce((prev, cur) => cur.lula + prev, 0)
            bolsonaro = stats.reduce((prev, cur) => cur.bolsonaro + prev, 0)
            lula_perc = lula / (lula + bolsonaro)
            bolsonaro_perc = bolsonaro / (lula + bolsonaro)
            $(`#numeroUrnasAtrasadas`).html(`${numeroUrnas.toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}<br><small>1 em cada ${(472028 / numeroUrnas).toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}</small>`)
            $(`#eleitoresUrnasAtrasadas`).html(`${eleitores.toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}<br><small>1 em cada ${(156453354 / eleitores).toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}</small>`)
            $(`#lulaUrnasAtrasadas`).html(`${lula.toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}<br><small>${lula_perc.toLocaleString('pt-Br', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })}</small>`)
            $(`#bolsonaroUrnasAtrasadas`).html(`${bolsonaro.toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}<br><small>${bolsonaro_perc.toLocaleString('pt-Br', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })}</small>`)
            $(`#diferencaUrnasAtrasadas`).html(`${(lula - bolsonaro).toLocaleString('pt-Br', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 0 })}`)

            atualizarMapaUrnasAtrasadas(urnasAtrasadasFiltradas)
            criarGraficoUrnasAtrasadas(urnasAtrasadasFiltradas)
        }

        function diferencaUrnas() {
            votacaoPorUrna.map(x => x.diff = x.LULA - x.BOLSONARO)
        }
        function ativarNavegador() {

            // An offset to push the content down from the top
            var listElement = $('#navegador li');



            listElement.find('a[href^="#"]').click(function (event) {
                // Prevent from default action to intitiate
                event.preventDefault();

                // The id of the section we want to go to.
                var anchorId = $(this).attr("href");

                // Our scroll target : the top position of the
                // section that has the id referenced by our href.
                if (anchorId.length > 1 && $(anchorId).length > 0) {
                    var target = $(anchorId).offset().top;
                }
                else {
                    var target = 0;
                }
                //console.log(target);


                $('html, body').animate({ scrollTop: target }, 100, function () {
                    //window.location.hash = '!' + id;
                    window.location.hash = anchorId;
                });

                setActiveListElements();

            });


            // Update current item class
            function setActiveListElements(event) {
                var windowPos = $(window).scrollTop();
                $('#navegador li a[href^="#"]').each(function () {

                    var currentLink = $(this);
                    if ($(currentLink.attr("href")).length > 0) {
                        var refElement = $(currentLink.attr("href"));
                        if (refElement.position().top <= windowPos && (refElement.position().top + refElement.height() + $("#navegador").height()) > windowPos) {
                            $('#navegador li a').removeClass("active");
                            currentLink.addClass("active");
                        }
                        else {
                            currentLink.removeClass("active");
                        }
                    }
                });
            }

            // Update menu item on scroll
            $(window).scroll(function () {
                // Call function
                setActiveListElements();
            });
        }

        $(`input[name=resultadoBolsonaroPorModeloUrnaTipoDeExibicao]`).change(function (el, attr) {

            if (this.value == "Tabela") {
                $(`#tabelaResultadoBolsonaroPorModeloUrnaPorEstadoDIV`).show()
                $(`#graficoResultadoBolsonaroPorModeloUrnaPorEstadoCanvas`).hide()
            }
            if (this.value == "Gráfico") {
                $(`#graficoResultadoBolsonaroPorModeloUrnaPorEstadoCanvas`).show()
                $(`#tabelaResultadoBolsonaroPorModeloUrnaPorEstadoDIV`).hide()
            }
        })

        function animate() {
            let i = 0
            animation = setInterval(function () {
                $(`#sliderUrnasAtrasadas`).val(i % 360)
                atualizarUrnasAtrasadas()
                i++
            }, 250)
        }

        function stop() {
            let i = 0
            animation = setInterval(function () {
                clearInterval(animation);
            })
        }
    </script>
</body>

</html>